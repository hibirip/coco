<!DOCTYPE html>
<html>
<head>
    <title>ì—…ë¹„íŠ¸ API í…ŒìŠ¤íŠ¸</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #0c0c0c; color: white; }
        .result { margin: 10px 0; padding: 10px; background: #232425; border-radius: 4px; }
        .success { background: #3ECF8E; color: black; }
        .error { background: #ff4757; }
        button { background: #3ECF8E; color: black; border: none; padding: 10px 20px; margin: 5px; border-radius: 4px; cursor: pointer; }
        pre { background: #0f0f0f; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>ì—…ë¹„íŠ¸ API ì—°ê²° í…ŒìŠ¤íŠ¸</h1>
    
    <button onclick="testUpbitDirect()">ì—…ë¹„íŠ¸ API ì§ì ‘ í˜¸ì¶œ</button>
    <button onclick="testUpbitService()">ì—…ë¹„íŠ¸ ì„œë¹„ìŠ¤ í˜¸ì¶œ</button>
    <button onclick="testBothAPIs()">ë‘ API ë¹„êµ</button>
    
    <div id="results"></div>

    <script>
        async function testUpbitDirect() {
            const results = document.getElementById('results');
            results.innerHTML += '<div class="result">ì—…ë¹„íŠ¸ API ì§ì ‘ í˜¸ì¶œ ì¤‘...</div>';
            
            try {
                const response = await fetch('https://api.upbit.com/v1/ticker?markets=KRW-BTC,KRW-ETH,KRW-XRP');
                if (response.ok) {
                    const data = await response.json();
                    results.innerHTML += '<div class="result success">âœ… ì—…ë¹„íŠ¸ API ì§ì ‘ í˜¸ì¶œ ì„±ê³µ</div>';
                    results.innerHTML += '<pre>' + JSON.stringify(data.slice(0, 1), null, 2) + '</pre>';
                } else {
                    results.innerHTML += '<div class="result error">âŒ ì—…ë¹„íŠ¸ API ì‘ë‹µ ì˜¤ë¥˜: ' + response.status + '</div>';
                }
            } catch (error) {
                results.innerHTML += '<div class="result error">âŒ ì—…ë¹„íŠ¸ API í˜¸ì¶œ ì‹¤íŒ¨: ' + error.message + '</div>';
            }
        }

        async function testUpbitService() {
            const results = document.getElementById('results');
            results.innerHTML += '<div class="result">ì—…ë¹„íŠ¸ ì„œë¹„ìŠ¤ í˜¸ì¶œ ì¤‘...</div>';
            
            try {
                // ì—…ë¹„íŠ¸ ì„œë¹„ìŠ¤ í•¨ìˆ˜ import (ì‹¤ì œë¡œëŠ” ëª¨ë“ˆì—ì„œ ê°€ì ¸ì™€ì•¼ í•¨)
                // ì—¬ê¸°ì„œëŠ” ì§ì ‘ êµ¬í˜„
                const markets = ['KRW-BTC', 'KRW-ETH', 'KRW-XRP'];
                const marketsParam = markets.join(',');
                const url = `https://api.upbit.com/v1/ticker?markets=${marketsParam}`;
                
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'User-Agent': 'Mozilla/5.0 (compatible; Coco-Upbit-Ticker/1.0)'
                    }
                });
                
                if (response.ok) {
                    const tickerArray = await response.json();
                    results.innerHTML += '<div class="result success">âœ… ì—…ë¹„íŠ¸ ì„œë¹„ìŠ¤ í˜¸ì¶œ ì„±ê³µ: ' + tickerArray.length + 'ê°œ ë§ˆì¼“</div>';
                    
                    // ë°ì´í„° ë³€í™˜ í…ŒìŠ¤íŠ¸
                    const transformedData = {};
                    tickerArray.forEach(ticker => {
                        const changePercent = (ticker.change_rate || 0) * 100;
                        transformedData[ticker.market] = {
                            market: ticker.market,
                            trade_price: parseFloat(ticker.trade_price || 0),
                            change: parseFloat(ticker.change_price || 0),
                            change_rate: parseFloat(ticker.change_rate || 0),
                            change_percent: changePercent,
                            timestamp: ticker.timestamp || Date.now(),
                            source: 'upbit-rest-api'
                        };
                    });
                    
                    results.innerHTML += '<pre>' + JSON.stringify(transformedData, null, 2) + '</pre>';
                } else {
                    results.innerHTML += '<div class="result error">âŒ ì—…ë¹„íŠ¸ ì„œë¹„ìŠ¤ ì‘ë‹µ ì˜¤ë¥˜: ' + response.status + '</div>';
                }
            } catch (error) {
                results.innerHTML += '<div class="result error">âŒ ì—…ë¹„íŠ¸ ì„œë¹„ìŠ¤ í˜¸ì¶œ ì‹¤íŒ¨: ' + error.message + '</div>';
            }
        }

        async function testBothAPIs() {
            const results = document.getElementById('results');
            results.innerHTML += '<div class="result">Bitget + ì—…ë¹„íŠ¸ API í…ŒìŠ¤íŠ¸ ì¤‘...</div>';
            
            // Bitget í…ŒìŠ¤íŠ¸
            try {
                const bitgetResponse = await fetch('/api/bitget/api/v2/spot/market/tickers');
                if (bitgetResponse.ok) {
                    const bitgetData = await bitgetResponse.json();
                    const btcData = bitgetData.data.find(coin => coin.symbol === 'BTCUSDT');
                    if (btcData) {
                        results.innerHTML += '<div class="result success">âœ… Bitget BTC ê°€ê²©: $' + btcData.lastPr + '</div>';
                    }
                } else {
                    results.innerHTML += '<div class="result error">âŒ Bitget API ì‹¤íŒ¨</div>';
                }
            } catch (error) {
                results.innerHTML += '<div class="result error">âŒ Bitget API ì˜¤ë¥˜: ' + error.message + '</div>';
            }
            
            // ì—…ë¹„íŠ¸ í…ŒìŠ¤íŠ¸
            try {
                const upbitResponse = await fetch('https://api.upbit.com/v1/ticker?markets=KRW-BTC');
                if (upbitResponse.ok) {
                    const upbitData = await upbitResponse.json();
                    if (upbitData.length > 0) {
                        results.innerHTML += '<div class="result success">âœ… ì—…ë¹„íŠ¸ BTC ê°€ê²©: â‚©' + upbitData[0].trade_price.toLocaleString() + '</div>';
                        
                        // ê¹€ì¹˜í”„ë¦¬ë¯¸ì—„ ê³„ì‚° ì‹œë®¬ë ˆì´ì…˜
                        const exchangeRate = 1362; // í˜„ì¬ í™˜ìœ¨
                        
                        // Bitget ë°ì´í„° ë‹¤ì‹œ ê°€ì ¸ì˜¤ê¸°
                        const bitgetResponse2 = await fetch('/api/bitget/api/v2/spot/market/tickers');
                        if (bitgetResponse2.ok) {
                            const bitgetData2 = await bitgetResponse2.json();
                            const btcData2 = bitgetData2.data.find(coin => coin.symbol === 'BTCUSDT');
                            if (btcData2) {
                                const bitgetPriceKRW = parseFloat(btcData2.lastPr) * exchangeRate;
                                const upbitPrice = upbitData[0].trade_price;
                                const premium = ((upbitPrice - bitgetPriceKRW) / bitgetPriceKRW) * 100;
                                
                                results.innerHTML += '<div class="result ' + (premium > 0 ? 'success' : 'error') + '">';
                                results.innerHTML += 'ğŸ† ê¹€ì¹˜í”„ë¦¬ë¯¸ì—„: ' + (premium > 0 ? '+' : '') + premium.toFixed(2) + '%';
                                results.innerHTML += '<br/>ì—…ë¹„íŠ¸: â‚©' + upbitPrice.toLocaleString();
                                results.innerHTML += '<br/>Bitget: â‚©' + bitgetPriceKRW.toLocaleString() + ' ($' + btcData2.lastPr + ' Ã— ' + exchangeRate + ')';
                                results.innerHTML += '</div>';
                            }
                        }
                    }
                } else {
                    results.innerHTML += '<div class="result error">âŒ ì—…ë¹„íŠ¸ API ì‹¤íŒ¨</div>';
                }
            } catch (error) {
                results.innerHTML += '<div class="result error">âŒ ì—…ë¹„íŠ¸ API ì˜¤ë¥˜: ' + error.message + '</div>';
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ í…ŒìŠ¤íŠ¸
        console.log('ì—…ë¹„íŠ¸ API í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ë¡œë“œë¨');
    </script>
</body>
</html>